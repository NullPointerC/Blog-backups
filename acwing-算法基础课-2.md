---
title: acwing-ç®—æ³•åŸºç¡€è¯¾-2
hidden: true
categories: algorithm
tags:
  - algorithm
  - è®¡ç®—æœºåŸºç¡€
abbrlink: 888fcc69
date: 2022-05-09 16:50:36
---

> ä»Šå¹´åˆæ˜¯ä¸å‡ºæ„å¤–çš„æ‹¿äº†è“æ¡¥æ¯Javaçœä¸€ï¼Œä¹Ÿå¯èƒ½æ˜¯å¤§å­¦æœŸé—´æœ€åä¸€åœºæ¯”èµ›äº†ï¼Œå¸Œæœ›å¯ä»¥å¥½å¥½å­¦ä¸€å­¦ç®—æ³•ï¼Œå†æ‰“å¾—å¥½ä¸€ç‚¹ï¼Œæ‹¿ä¸€ä¸ªå›½å¥–å§^ _ ^ã€‚ğŸ­ğŸ­ğŸ­

## é™æ€å•é“¾è¡¨

é™æ€é“¾è¡¨ä¹Ÿæ˜¯é“¾è¡¨çš„ä¸€ç§ï¼Œå’ŒåŠ¨æ€é“¾è¡¨ä¸åŒç‚¹åœ¨äºï¼ŒåŠ¨æ€é“¾è¡¨é€šå¸¸ä½¿ç”¨ç»“æ„ä½“å’ŒæŒ‡é’ˆæ¥å®ç°ï¼Œå› æ­¤æ¯åˆ›å»ºä¸€ä¸ªç»“ç‚¹ï¼Œå°±éœ€è¦è¿›è¡Œå†…å­˜åˆ†é…ï¼Œå¯¹äºç®—æ³•ç«èµ›æ¥è¯´ï¼Œè¿™æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œå› è€Œé€šå¸¸ä¼šä½¿ç”¨é™æ€é“¾è¡¨æ¥å®ç°ã€‚

é™æ€é“¾è¡¨åŒ…æ‹¬4ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯`head`,`idx`,`e[]`å’Œ`ne[]`ã€‚

å…¶ä¸­`head`æŒ‡å‘å¤´ç»“ç‚¹çš„ä¸‹æ ‡ï¼Œä¸‹æ ‡è®¾ç½®ä¸ºä»0å¼€å§‹ã€‚

`idx`è®°å½•äº†å½“å‰æ“ä½œçš„ä½ç½®ï¼Œå¦‚æ“ä½œè‡³ç¬¬å‡ ä¸ªæ•°ã€‚

`e[]`æ•°ç»„è®°å½•äº†`i`ä¸‹æ ‡çš„ç»“ç‚¹å€¼ã€‚

`ne[]`æ•°ç»„è®°å½•äº†é¢`i`æ ‡è®°çš„ä¸‹ä¸€ä¸ªç»“ç‚¹çš„ä¸‹æ ‡ï¼Œå…¶ä¸­ä»¥`-1`ä½œä¸ºå°¾éƒ¨ç»“ç‚¹ã€‚

å¦‚ä¸‹ä¸ºé™æ€å•é“¾è¡¨çš„æ¨¡æ¿ï¼š

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N = 100010;

// headè¡¨ç¤ºå¤´ç»“ç‚¹ä¸‹æ ‡,e[i]è¡¨ç¤ºèŠ‚ç‚¹içš„å€¼,ne[i]è¡¨ç¤ºèŠ‚ç‚¹içš„nextæŒ‡é’ˆæ˜¯å¤šå°‘,idxè¡¨ç¤ºå½“å‰å·²ç»ç”¨åˆ°äº†å“ªä¸ªç‚¹
int head, e[N], ne[N], idx;

// åˆå§‹åŒ–å•é“¾è¡¨
void init()
{
	head = -1;
	idx = 0;
}

// å‘é“¾è¡¨å¤´éƒ¨æ·»åŠ å€¼ä¸ºxçš„ç‚¹ä½œä¸ºæ–°çš„å¤´
void add_to_head(int x)
{
	e[idx] = x;
	ne[idx] = head;
	head = idx;
	idx++;
}

// åœ¨ä¸‹æ ‡kåæ·»åŠ å€¼ä¸ºxçš„ç‚¹
void add(int k, int x)
{
	e[idx] = x;
	ne[idx] = ne[k];
	ne[k] = idx;
	idx++;
}
// åˆ é™¤ä¸‹æ ‡kåçš„ç‚¹
void remove(int k)
{
	ne[k] = ne[ne[k]];
}


int main()
{
	init();
	int m;
	cin >> m;
	while (m--)
	{
		int k, x;
		char op;
		cin >> op;
		if (op == 'H')
		{
			cin >> x;
			add_to_head(x);
		}
		else if (op == 'D')
		{
			cin >> k;
			if (!k) head = ne[head];
			remove(k - 1);
		}
		else 
		{
			cin >> k >> x;
			add(k - 1, x);
		}
	}
	for (int i = head; i != -1; i = ne[i])
	{
		cout << e[i] << ' ';
	}
	cout << endl;
	return 0;
}
```

## é™æ€åŒé“¾è¡¨

é™æ€åŒå‘é“¾è¡¨å’Œé™æ€å•é“¾è¡¨è¡¨ç¤ºæ³•ç±»ä¼¼,ä½†æ˜¯ç”±äºè¿˜éœ€è¦æœ‰å‰é©±æŒ‡é’ˆ,å› ä¸ºé™¤äº†æœ‰`r[]`æ•°ç»„è¡¨ç¤ºä¸‹ä¸€ä¸ªç»“ç‚¹ä½ç½®çš„æŒ‡é’ˆå¤–ï¼Œè¿˜æœ‰`l[]`æ•°ç»„è¡¨ç¤ºæŒ‡å‘ä¸Šä¸€ä¸ªç»“ç‚¹ä½ç½®çš„æŒ‡é’ˆã€‚

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N = 100010;

int e[N], l[N], r[N], idx;

// åˆå§‹åŒ–åŒé“¾è¡¨
void init()
{
	// å‡å®š0ä¸ºå¤´ç»“ç‚¹ä¸‹æ ‡,1ä¸ºå°¾ç»“ç‚¹ä¸‹æ ‡,åˆå§‹ä¸‹æ ‡ä»2å¼€å§‹è®¡ç®—
	r[0] = 1;
	l[1] = 0;
	idx = 2;
}

// åœ¨ä¸‹æ ‡ä¸ºkçš„èŠ‚ç‚¹åæ·»åŠ å€¼ä¸ºxçš„ç‚¹
void add(int k, int x)
{
	e[idx] = x;
	r[idx] = r[k];
	l[idx] = k;
	l[r[k]] = idx;
	r[k] = idx;
	idx++;
}

// åˆ é™¤ä¸‹æ ‡ä¸ºkå³è¾¹çš„ç‚¹
void remove(int k)
{
	r[l[k]] = r[k];
	l[r[k]] = l[k];
}

int main()
{
	return 0;
}
```

## æ ˆ

å…·æœ‰FILOæ€§è´¨çš„çº¿æ€§è¡¨ï¼Œä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºæŸç§åŒ¹é…å…³ç³»ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N = 100010;

int stk[N], tt;

// åˆå§‹åŒ–æ ˆ
void init()
{
	tt = 0;
}

// å¾€æ ˆä¸­å¡«å…¥ä¸€ä¸ªå…ƒç´ x
void push(int x)
{
	stk[++tt] = x;
}
// å¼¹å‡ºæ ˆé¡¶
void pop()
{
	tt--;
}

// å–å‡ºæ ˆé¡¶
int top()
{
	return stk[tt];
}

bool empty()
{
	return tt > 0;
}


int main()
{
	return 0;
}
```

## é˜Ÿåˆ—

å’Œæ ˆä¸åŒï¼Œæ·»åŠ å…ƒç´ å’Œå–å‡ºå…ƒç´ åˆ†åˆ«åœ¨ä¸¤ç«¯è¿›è¡Œï¼Œå› è€Œå…·æœ‰FIFOçš„æ€§è´¨ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N = 100010;


int q[N], hh, tt;

void init()
{
	hh = 0;
	tt = -1;	
}

// é˜Ÿå°¾æ’å…¥ä¸€ä¸ªå…ƒç´ 
void push(int x)
{
	q[++tt] = x;
}

// åˆ é™¤é˜Ÿå¤´
void pop()
{
	hh++;
}

int top()
{
	return q[hh];
}

// åˆ¤æ–­æ˜¯å¦ä¸ºç©º
bool empty()
{
	return hh > tt;
}

int main()
{
	return 0;
}
```

## å¾ªç¯é˜Ÿåˆ—

è§£å†³äº†é˜Ÿåˆ—ä¸­å‡æº¢å‡ºçš„é—®é¢˜ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N = 100010;


// hh è¡¨ç¤ºé˜Ÿå¤´ï¼Œttè¡¨ç¤ºé˜Ÿå°¾çš„åä¸€ä¸ªä½ç½®
int q[N], hh, tt;

void init()
{
	hh = 0;
	tt = 0;
}

// å‘é˜Ÿå°¾æ’å…¥ä¸€ä¸ªæ•°
void push(int x)
{
	q[tt ++ ] = x;
	if (tt == N) tt = 0;
}

// ä»é˜Ÿå¤´å¼¹å‡ºä¸€ä¸ªæ•°
void pop()
{
	hh ++ ;
	if (hh == N) hh = 0;
}

// é˜Ÿå¤´çš„å€¼
int top()
{
	return q[hh];
}

// åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º
bool empty()
{
	return hh == tt;
}

int main()
{
	return 0;
}
```

## å•è°ƒæ ˆ

å¸¸è§æ¨¡å‹ï¼šæ‰¾å‡ºæ¯ä¸ªæ•°å·¦è¾¹è·ç¦»å®ƒæœ€è¿‘çš„æ¯”å®ƒå¤§ã€å°çš„æ•°ã€‚

æ¨ç†å¦‚ä¸‹ï¼š

é¦–å…ˆå‡å®šï¼Œå¦‚æœæˆ‘ä»¬è¦æ‰¾æ¯ä¸ªæ•°$a_i$ï¼Œå®ƒå·¦è¾¹è·ç¦»å®ƒæœ€è¿‘çš„æ¯”å®ƒå°çš„å…ƒç´ ï¼Œå‡å®šæˆ‘ä»¬å·²ç»å°†$a_i$å·¦è¾¹çš„æ‰€æœ‰å…ƒç´ éƒ½æ·»åŠ è¿›äº†æ ˆä¸­ï¼Œ$a_0,a_1,a_2...a_{n-2},a_{n-1}$ã€‚

å¦‚æœå­˜åœ¨æœ‰è¿™æ ·çš„å…³ç³»$a_x >= a_y$ä¸”æ»¡è¶³$x<y$ï¼Œé‚£ä¹ˆå¯ä»¥å‘ç°$a_x$æ°¸è¿œä¹Ÿä¸ä¼šè¢«é€‰ä¸­ï¼Œå› ä¸º$a_y$è·ç¦»$a_i$æ›´è¿‘ï¼Œå› æ­¤ï¼Œå¦‚æœå‘ç°è¿™æ ·çš„å…³ç³»ï¼Œå°±å¯ä»¥ä¸å¿…å°†å…¶åŠ å…¥æ ˆä¸­ä½œä¸ºé€‰æ‹©ï¼Œå› æ­¤ï¼Œå¯¹äºæ ˆä¸­çš„åºåˆ—ï¼Œå¯ä»¥å‘ç°è¿™æ˜¯ä¸€ä¸ª**ä¸¥æ ¼å•è°ƒä¸Šå‡**çš„åºåˆ—ã€‚

å¹¶ä¸”ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ‰¾åˆ°$a_i$å·¦è¾¹è·ç¦»æœ€è¿‘çš„æ›´å°çš„æ•°ï¼Œä¸æ ˆé¡¶ç›¸æ¯”è¾ƒï¼Œå¦‚æœå‘ç°$a_i \le top()$ï¼Œå¯ä»¥å¾—åˆ°$top()$ä¹Ÿæ°¸è¿œä¸ä¼šè¢«$a_i$é€‰ä¸­ï¼Œå¯ä»¥åˆ é™¤ï¼Œå¯¹äº$a_i$å³è¾¹çš„æ•°æ¥è¯´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

å› ä¸ºå¦‚æœå¯¹äº$a_j(j>i)$è€Œè¨€ï¼Œè‹¥$a_i\lt a_j$ï¼Œé‚£ä¹ˆ$a_i$å°±å¯ä»¥å…ˆäº$top()$è¢«é€‰ä¸­ï¼Œå› æ­¤$top()$å¯ä»¥è¢«åˆ é™¤ï¼›

å¦‚æœ$a_i\ge a_j$ï¼Œè€Œ$top() \ge a_i$ï¼Œå› æ­¤$top() \ge a_j$ï¼Œæ›´åŠ ä¸å¯èƒ½ä½œä¸º$a_j$å·¦è¾¹è·ç¦»æœ€è¿‘çš„æ›´å°å€¼ï¼Œå› æ­¤ï¼Œç»¼ä¸Šï¼Œå½“éå†è‡³$a_i$ä¸”$a_i \le top()$æ—¶ï¼Œ$top()$å¯ä»¥è¢«åˆ å»ã€‚

æ¨¡æ¿å¦‚ä¸‹ï¼š

```cpp
int tt = 0;
for (int i = 1; i <= n; i ++ )
{
    // checkè¡¨ç¤ºä¸ºæ ˆé¡¶ä¸içš„å…³ç³»,éœ€è¦è¯•ä¸åŒæƒ…å†µè€Œè®º
    while (tt && check(stk[tt], i)) tt -- ;
    stk[ ++ tt] = i;
}
```

[é¢˜ç›®é“¾æ¥](https://www.acwing.com/problem/content/832/)

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>

using namespace std;

const int N = 100010;

// stack
int stk[N], tt = 0;

// arr
int q[N];

int main()
{
	int n;
	cin >> n;
	while (n--)
	{
		int x;
		cin >> x;
		while (tt && stk[tt] >= x) tt--;
		if (!tt) cout << -1 << ' ';
		else cout << stk[tt] << ' ';
		stk[++tt] = x;
	}
	return 0;
}
```



## å•è°ƒé˜Ÿåˆ—

åœºæ™¯æ¨¡å‹ï¼šæ»‘åŠ¨çª—å£å†…çš„æœ€å€¼é—®é¢˜ã€‚

æ¨ç†å¦‚ä¸‹ï¼š

é¦–å…ˆå‡å®šï¼Œå¯¹äºæ•°ç»„$a_1,a_2,a_3...a_{n-1},a_n$ï¼Œé€‰æ‹©ä¸€ä¸ªå¤§å°ä¸º$k$çš„çª—å£ï¼Œä¾æ¬¡å°†çª—å£æ»‘åŠ¨ï¼Œé€‰æ‹©æ¯ä¸ªçª—å£ä¸­çš„æœ€å°å€¼ã€‚

ç”±äºè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠä¸€ä¸ªå…ƒç´ åŠ å…¥åˆ°çª—å£å’Œä¸€ä¸ªå…ƒç´ è¢«å¼¹å‡ºçª—å£ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨é˜Ÿåˆ—æ¥æ¨¡æ‹Ÿï¼Œè€Œå¯¹äºè¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å¯¹äºé˜Ÿåˆ—ä¸­çš„å€¼$q_1,q_2,q_3...$ã€‚

å¦‚æœé˜Ÿåˆ—ä¸­å­˜åœ¨æœ‰è¿™æ ·çš„é€†åºå¯¹ï¼Œ$q_i \gt q_j$ä¸”$i \lt j$ï¼Œå¯ä»¥å¾—åˆ°$q_i$æ°¸è¿œä¹Ÿä¸ä¼šè¢«é€‰ä¸­ï¼Œå› ä¸º$q_j$çš„å¤§å°é¦–å…ˆç¡®ä¿ä¼šè¢«é€‰ä¸­ï¼Œå…¶æ¬¡$j$çš„ä½ç½®é åä¿è¯äº†$q_j$çš„å­˜æ´»æ—¶é•¿ä¼šæ¯”$q_i$é•¿ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™æ ·çš„é€†åºå¯¹ä¸­çš„$q_i$åˆ å»ï¼Œæœ€åå¯ä»¥å¾—åˆ°$q$æ˜¯ä¸€ä¸ª**ä¸¥æ ¼å•è°ƒä¸Šå‡**çš„åºåˆ—ã€‚

è€Œåˆå› ä¸º$q_i$æ˜¯ä¸€ä¸ªä¸¥æ ¼å•è°ƒä¸Šå‡çš„åºåˆ—ï¼Œéœ€è¦å¾—åˆ°åºåˆ—$q$çš„æœ€å°å€¼ï¼Œåªéœ€è¦å–å¾—é˜Ÿå¤´çš„å€¼å³å¯ã€‚

æ¨¡æ¿å¦‚ä¸‹ï¼š

```cpp
int hh = 0, tt = -1;
for (int i = 0; i < n; i ++ )
{
    while (hh <= tt && check_out(q[hh])) hh ++ ;  // åˆ¤æ–­é˜Ÿå¤´æ˜¯å¦æ»‘å‡ºçª—å£
    while (hh <= tt && check(q[tt], i)) tt -- ;
    q[ ++ tt] = i;
}
```

æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨å•è°ƒæ ˆå’Œå•è°ƒé˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯å…ˆä½¿ç”¨æ ˆå’Œé˜Ÿåˆ—æ¥æ¨¡æ‹Ÿè¿™ä¸ªå®Œæ•´çš„è¿‡ç¨‹ï¼Œå†ä»ä¸­åˆ†æå“ªäº›æ˜¯è‚¯å®šä¸ä¼šå…¥æ ˆæˆ–è€…å…¥é˜Ÿçš„å…ƒç´ ï¼Œèˆå¼ƒè¿™äº›å…ƒç´ çš„å…¥æ ˆå’Œå…¥é˜Ÿè¿‡ç¨‹ï¼Œæœ€åå°±å¯ä»¥å¾—åˆ°ç»è¿‡ä¼˜åŒ–è¿‡åçš„é—®é¢˜æ¨¡å‹ã€‚

[é¢˜ç›®é“¾æ¥](https://www.acwing.com/problem/content/156/)

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>

using namespace std;

const int N = 1000010;

int a[N], q[N];
// é˜Ÿå¤´,é˜Ÿå°¾ç´¢å¼•
int hh, tt;
// åˆå§‹åŒ–é˜Ÿåˆ—
void init()
{
	hh = 0, tt = -1;
}
int main()
{
	init();
	int n, k;
	cin >> n >> k;
	for (int i = 0; i < n; i++) 
	{
		cin >> a[i];
	}
	for (int i = 0; i < n; i++) 
	{
		// çª—å£å†…çš„ä¸‹æ ‡èŒƒå›´åº”è¯¥åœ¨[i - k + 1, i]ä¹‹é—´,å¦åˆ™é˜Ÿå¤´å‡ºé˜Ÿ
		while (hh <= tt && i - k + 1 > q[hh]) 
		{
			hh++;
		}
		// ä¿è¯é˜Ÿåˆ—å†…æ˜¯ä¸¥æ ¼å•è°ƒä¸Šå‡çš„
		while (hh <= tt && a[q[tt]] >= a[i])
		{
			tt--;
		}
		// iä½ç½®å…¥é˜Ÿ
		q[++tt] = i;
		// çª—å£å†…æœ‰kä¸ªå€¼äº†å¼€å§‹è¾“å‡º
		if (i >= k - 1)
		{
			cout << a[q[hh]] << ' ';
		}
		
	}
	cout << endl;
	init();
	for (int i = 0; i < n; i++)
	{
		// çª—å£å†…çš„ä¸‹æ ‡èŒƒå›´åº”è¯¥åœ¨[i - k + 1, i]ä¹‹é—´,å¦åˆ™é˜Ÿå¤´å‡ºé˜Ÿ
		while (hh <= tt && i - k + 1 > q[hh]) 
		{
			hh++;
		}
		// ä¿è¯é˜Ÿåˆ—å†…æ˜¯ä¸¥æ ¼å•è°ƒå‡å°‘çš„
		while (hh <= tt && a[q[tt]] <= a[i])
		{
			tt--;
		}
		// iä½ç½®å…¥é˜Ÿ
		q[++tt] = i;
		// çª—å£å†…æœ‰kä¸ªå€¼äº†å¼€å§‹è¾“å‡º
		if (i >= k - 1)
		{
			cout << a[q[hh]] << ' ';
		}
	}
	
	return 0;
}
```

## KMP

é¦–å…ˆè€ƒè™‘å¦‚ä½•ä»æš´åŠ›æšä¸¾åˆ°ä¼˜åŒ–ï¼š

å‡å®šä»$S[M]$ä¸²ä¸­æ‰¾åˆ°æ¨¡å¼ä¸²$P[N]$ï¼Œæˆ‘ä»¬æšä¸¾åŸä¸²çš„æ¯ä¸€ä¸ªä½ç½®ä½œä¸ºåŒ¹é…çš„èµ·ç‚¹ï¼Œç„¶åä»è¿™é‡Œå¼€å§‹æ¯”è¾ƒå’Œæ¨¡å¼ä¸²$P$çš„æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œè‹¥$j$æŒ‡é’ˆåˆšå¥½å¯ä»¥èµ°$N$æ­¥ï¼Œè¯´æ˜$i$ä½ç½®æ­£æ˜¯ä¸€ä¸ªç›¸åŒ¹é…çš„ä½ç½®ã€‚

æœ´ç´ çš„æšä¸¾æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>

using namespace std;
const int M = 100010, N = 10010;
char p[N], s[M];
int n, m;
int main()
{
	cin >> n >> p  >> m >> s;
	for (int i = 0; i < m; i++) 
	{
		int j;
		for (j = 0; j < n; j++)
		{
			if (p[j] != s[i + j]) 
			{
				break;
			}
		}
		if (j == n) 
		{
			printf("%d ", i);
		}
	}
	return 0;
}
```

ä¸Šè¿°æœ´ç´ è§£çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(M \times N)$ï¼Œç©ºé—´å¤æ‚åº¦ä¸º$O(1)$ã€‚

å­˜åœ¨çš„é—®é¢˜æ˜¯å½“æ¨¡å¼ä¸²$P$èµ°åˆ°äº†ä¸åŒ¹é…çš„ä½ç½®$j$æ—¶ï¼Œæ²¡æœ‰ç”¨åˆ°å·²ç»åŒ¹é…çš„$P[0...j-1]$è¿™æ®µï¼Œè€Œæ˜¯éœ€è¦åŒæ—¶å›é€€å·²èµ°è¿‡çš„$i$æŒ‡é’ˆå’Œ$j$æŒ‡é’ˆã€‚

![image-20220519135718026](https://static.codenote.xyz/img/202205191357135.png)

ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‘ï¼Œç”±äºå·²ç»åŒ¹é…äº†$S[i...j - 1]$å’Œ$P[0...j - 1]$è¿™äº›éƒ¨åˆ†ï¼Œæ‰€ä»¥å­˜åœ¨è¿™äº›ä¿¡æ¯æœªè¢«åˆ©ç”¨ä¸Šã€‚

äºæ˜¯è€ƒè™‘åˆ©ç”¨åŸæœ‰çš„åŒ¹é…ä¿¡æ¯ï¼Œæ¨¡å¼ä¸²$P$èƒ½å¦ä¸**æ¯æ¬¡åªç§»åŠ¨ä¸€ä¸ªå•ä½**ï¼Œè€Œæ˜¯**ç§»åŠ¨è‹¥å¹²ä¸ªå•ä½å¯ä»¥ç›´æ¥æ‰¾åˆ°ä¸‹ä¸€æ®µå¯åŒ¹é…çš„ä½ç½®**ã€‚

![image-20220528135658627](https://static.codenote.xyz/img/202205281356754.png)

äºæ˜¯è€ƒè™‘å¯¹æ¨¡å¼ä¸²$P$è¿›è¡Œé¢„å¤„ç†ï¼Œå¤„ç†å‡ºä»¥æ¯ä¸ªç‚¹ä¸ºç»ˆç‚¹çš„åç¼€å’Œå‰ç¼€ç›¸ç­‰ï¼Œç›¸ç­‰çš„æœ€å¤§é•¿åº¦æ˜¯å¤šå°‘ï¼Œé€šå¸¸ä¹Ÿç§°$next$æ•°ç»„ã€‚

$next[i]$ä¹Ÿå°±è¡¨ç¤ºä»¥$i$ä¸ºç»ˆç‚¹çš„åç¼€ï¼Œå’Œä»$1$å¼€å§‹çš„å‰ç¼€ç›¸ç­‰ï¼Œè€Œä¸”åç¼€é•¿åº¦æœ€é•¿çš„é•¿åº¦ã€‚

![image-20220528140405557](https://static.codenote.xyz/img/202205281404630.png)

äºæ˜¯ï¼Œåˆ©ç”¨ä¸Š$next[]$çš„å«ä¹‰ï¼Œå°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„åŒ¹é…è¿‡ç¨‹ã€‚

![image-20220528141928262](https://static.codenote.xyz/img/202205281419364.png)

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>

using namespace std;

const int N = 10010, M = 100010;

int n, m;
char p[N], s[M];
int ne[N];


int main()
{
	// ä¸‹æ ‡ä»1å¼€å§‹
	cin >> n >> p + 1 >> m >> s + 1;
	
	// æ±‚nextè¿‡ç¨‹
	for (int i = 2, j = 0; i <= n; i++)
	{
		while (j && p[i] != p[j + 1])
		{
			j = ne[j];	
		}
		if (p[i] == p[j + 1])
		{
			j++;
		}
		ne[i] = j;
	}
	
	// kmpåŒ¹é…è¿‡ç¨‹
	for (int i = 1, j = 0; i <= m; i++)
	{
		// jè¿˜æœªé€€å›èµ·ç‚¹å¹¶ä¸”å½“å‰s[i]ä¸èƒ½å’Œp[j+1]åŒ¹é…
		while (j && s[i] != p[j + 1])
		{
			j = ne[j];
		}
		// ä¸Šè¿°å¾ªç¯æœ‰ä¸¤ä¸ªé€€å‡ºæ¡ä»¶,è¿™é‡Œéœ€è¦éªŒè¯æ˜¯å¦å·²ç»åŒ¹é…æˆåŠŸäº†,åŒ¹é…æˆåŠŸäº†åˆ™ç§»åŠ¨jæŒ‡é’ˆ
		if (s[i] == p[j + 1])
		{
			j++;
		}
		if (j == n)
		{
			// åŒ¹é…æˆåŠŸ
			printf("%d ", i - n);
			j = ne[j];// 
		}
	}
	return 0;
}
```

## Trie

å­—å…¸æ ‘ï¼Œç”¨äºé«˜æ•ˆåœ°**å­˜å‚¨å’ŒæŸ¥æ‰¾å­—ç¬¦ä¸²é›†åˆ**çš„æ•°æ®ç»“æ„ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>

using namespace std;


const int N = 100010;


// son[][]å­˜å‚¨æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹
// cnt[]å­˜å‚¨ä»¥æ¯ä¸ªèŠ‚ç‚¹ç»“å°¾çš„å•è¯æ•°é‡
// idxè¡¨ç¤ºå½“å‰ç”¨åˆ°äº†ç¬¬å‡ ä¸ªç¼–å·,0å·ç‚¹æ—¢æ˜¯æ ¹èŠ‚ç‚¹ï¼Œåˆæ˜¯ç©ºèŠ‚ç‚¹
int son[N][26], cnt[N], idx;
char str[N];

void insert(char str[])
{
	int p = 0;
	for (int i = 0; str[i]; i++)
	{
		// åˆ¤æ–­å½“å‰çš„èŠ‚ç‚¹æ˜¯å¦æœ‰è¿™æ¡è·¯å¾„
		int u = str[i] - 'a';
		// ä¸å­˜åœ¨åˆ™åˆ›å»ºå‡ºæ¥
		if (!son[p][u])
		{
			son[p][u] = ++idx;
		}
		p = son[p][u];
	}
	// pè¡¨ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„ç¼–å·
	cnt[p]++;
}

int query(char str[])
{
	int p = 0;
	for (int i = 0; str[i]; i++)
	{
		int u = str[i] - 'a';
		if (!son[p][u]) return 0;
		p = son[p][u];
	}
	return cnt[p];
}


int main()
{
	int n;
	scanf("%d", &n);
	while (n--)
	{
		char op[2];
		scanf("%s%s", op, str);
		if (op[0] == 'I')
		{
			insert(str);
		}
		else
		{
			printf("%d\n", query(str));
		}
	}
	return 0;
}
```

## å¹¶æŸ¥é›†

å¹¶æŸ¥é›†ç”¨äºå¤„äºé›†åˆå…³ç³»ã€‚ä¸€èˆ¬åŒ…æ‹¬**å°†ä¸¤ä¸ªé›†åˆåˆå¹¶ã€è¯¢é—®ä¸¤ä¸ªå…ƒç´ åœ¨åŒä¸€ä¸ªé›†åˆä¸­**ã€‚

å¹¶æŸ¥é›†å¯ä»¥åœ¨è¿‘ä¹$O(1)$çš„æ—¶é—´å¤æ‚åº¦å†…å®Œæˆä¸Šè¿°ä¸¤ä¸ªæ“ä½œã€‚

åŸºæœ¬åŸç†ï¼šæ¯ä¸ªé›†åˆç”¨ä¸€é¢—æ ‘æ¥è¡¨ç¤ºï¼Œæ ‘æ ¹çš„ç¼–å·å°±æ˜¯æ•´ä¸ªé›†åˆçš„ç¼–å·ã€‚

æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨å®ƒçš„çˆ¶èŠ‚ç‚¹ï¼Œç”¨$fa[x]$è¡¨ç¤º$x$çš„çˆ¶èŠ‚ç‚¹ã€‚

æ ‘æ ¹çš„æ¡ä»¶ï¼š$fa[x] = x$ã€‚

æ±‚å¾—$x$çš„é›†åˆç¼–å·ï¼š

```cpp
while (fa[x] != x)
{
	x = fa[x];
}
```

å«è·¯å¾„å‹ç¼©çš„æœ´ç´ å¹¶æŸ¥é›†ï¼š

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>

using namespace std;

const int N = 100010;
// æ¯ä¸ªå…ƒç´ çš„çˆ¶èŠ‚ç‚¹
int fa[N];
// nè¡¨ç¤ºèŠ‚ç‚¹æ ¼å¼,mè¡¨ç¤ºæ“ä½œæ¬¡æ•°
int n, m;
// åˆå§‹åŒ–å¹¶æŸ¥é›†
void init()
{
	for (int i = 1; i <= n; i++)
	{
		fa[i] = i;
	}
}

// è¿”å›xæ‰€åœ¨é›†åˆçš„ç¼–å·
int find(int x)
{
	if (x != fa[x])
	{
		// å¸¦æœ‰è·¯å¾„å‹ç¼©
		fa[x] = find(fa[x]);
	}
	return fa[x];
}
// æŠŠaçš„çˆ¶äº²åŠ å…¥åˆ°bæ‰€åœ¨çš„é›†åˆä¸­
void merge(int a, int b)
{
	fa[find(a)] = find(b);
}

// åˆ¤æ–­a,bæ˜¯å¦å±äºåŒä¸€ä¸ªé›†åˆ
bool query(int a, int b)
{
	return find(a) == find(b);
}

int main()
{
	scanf("%d%d", &n, &m);
	init();
	while (m--)
	{
		char op[2];
		int a, b;
		scanf("%s%d%d", op, &a, &b);
		if (op[0] == 'M')
		{
			merge(a, b);
		}
		else if (op[0] == 'Q')
		{
			if (query(a, b)) 
			{
				puts("Yes");
			}
			else
			{
				puts("No");
			}
		}
	}
	return 0;
}
```

ä»¥ä¸Šå³ä¸ºæœ´ç´ çš„å¹¶æŸ¥é›†ï¼Œå¯ä»¥å¿«é€Ÿå¤„ç†é›†åˆçš„åˆå¹¶å’ŒæŸ¥è¯¢æ“ä½œï¼Œä¸€èˆ¬è¿˜ä¼šè¿›è¡Œå»¶ä¼¸ï¼ŒåŒ…æ‹¬ç»´æŠ¤$size$çš„å¹¶æŸ¥é›†ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <algorithm>

using namespace std;


const int N = 100010;
// fa[x]è¡¨ç¤ºèŠ‚ç‚¹xçš„çˆ¶èŠ‚ç‚¹,size[x]åªæœ‰å½“xèŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹æ—¶æ‰æœ‰å«ä¹‰,è¡¨ç¤ºä¸ºçˆ¶èŠ‚ç‚¹æ‰€åœ¨é›†åˆä¸­èŠ‚ç‚¹ä¸ªæ•°
int fa[N], sz[N];
// nè¡¨ç¤ºèŠ‚ç‚¹ä¸ªæ•°,mè¡¨ç¤ºæ“ä½œæ•°
int n, m;

// åˆå§‹åŒ–å¹¶æŸ¥é›†
void init()
{
	for (int i = 1; i <= n; i++)
	{
		// å°†içš„çˆ¶äº²è®¾ç½®ä¸ºè‡ªèº«
		fa[i] = i;
		// æ¯ä¸ªèŠ‚ç‚¹æ‰€åœ¨é›†åˆåˆå§‹ä¸ªæ•°ä¸º1
		sz[i] = 1;
	}
}

int find(int x)
{
	if (x != fa[x])
	{
		// å¸¦æœ‰è·¯å¾„å‹ç¼©
		fa[x] = find(fa[x]);
	}
	return fa[x];
}

// å°†èŠ‚ç‚¹aæ‰€åœ¨é›†åˆå¹¶å…¥èŠ‚ç‚¹bæ‰€åœ¨é›†åˆ
void merge(int a, int b)
{
	a = find(a), b = find(b);
	if (a != b)
	{
		fa[a] = b;
		// ç»´æŠ¤ä¸ªæ•°
		sz[b] += sz[a];
	}
}

// åˆ¤æ–­èŠ‚ç‚¹a,bæ˜¯å¦åœ¨åŒä¸€é›†åˆä¸­
bool query(int a, int b)
{
	return find(a) == find(b);
}
// è®¡ç®—xæ‰€åœ¨é›†åˆä¸­èŠ‚ç‚¹ä¸ªæ•°
int count(int x)
{
	return sz[find(x)];
}

int main()
{
	scanf("%d%d", &n, &m);
	init();
	while (m--)
	{
		string op;
		int a, b;
		cin >> op;
		if (op == "C") 
		{
			scanf("%d%d", &a, &b);
			merge(a, b);
		}
		else if (op == "Q1")
		{
			scanf("%d%d", &a, &b);
			if (query(a, b)) {
				puts("Yes");
			} else {
				puts("No");
			}
		}
		else if (op == "Q2")
		{
			scanf("%d", &a);
			printf("%d\n", count(a));
		}
	}
	return 0;
}
```



