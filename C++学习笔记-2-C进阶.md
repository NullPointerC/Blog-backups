---
title: C++学习笔记-2-C进阶
date: 2021-07-17 17:08:12
categories: C++
tags: [C++,backend,计算机基础]
---
## 预处理

### 函数式宏

函数式宏可以像函数调用一样在代码中使用。

```c
#define MAX(a,b) ((a)>(b)?(a):(b))
k = MAX(i&0xof,j&0xof)
```

函数式宏与函数的区别：

1. 函数式宏定义的参数没有类型，预处理器只负责进行形式上的替换，而不做参数类型检查；
2. 调用真正的函数和调用函数式宏定义的代码编译生成的指令不同；
3. 不能省略最外层括号；

函数式宏定义和真正的函数相比有很多缺点，但只要小心使用还是会显著提高代码的执行效率，一般来说简短的、被频繁调用的函数适合用函数式宏定义来代替实现。

函数式宏定义经常写成以下形式：

```c
#define device_init_wakeup(dev,val)\
	do{\
		device_can_wakeup(dev) == !!(val);\
		device_set_wakeup_enable(dev,val);\
		}while(0)
```

因为宏展开不允许有分号在末尾，所以采用do-while进行一次操作。

### 条件预处理

常用于头文件中：

```c
#ifndef HEADER_FILENAME
#define HEADER FILENAME
/*body of header*/
#endif
```

## 指针

把一个变量所在的内存单元的地址保存在另外一个内存单元中，保存地址的这个内存单元称为指针

&是取地址运算符，&i表示取变量i的地址；

＊是指针间接寻址运算符，＊pi表示取指针pi所指向的变量的值；

void ＊指针与其他类型的指针之间可以隐式转换，也称通用指针；

### 指针与数组

指针里保存的是数组首个元素的地址

### 指针与const

```c
const int *a;
int const *a;
```

这两种写法一样，a是一个指向const int型的指针，a所指向的内存单元不可改写,但指针a本身可以改写，即a可以指向别的内存单元。

```c
int * const a;
```

a是一个指向int型的const指针，＊a是可以改写的，但a本身不允许改写。

```c
int const * const a;
```

a是一个指向const int型的const指针，因此＊a和a本身都不允许改写。

### 指针与结构体

```c
struct unit{
	char c;
    int num;
};
struct unit u;
struct unit * p = &u;
```

C语言提供了->运算符,可通过指针对结构体中的变量进行修改；

### 指向指针的指针与指针数组

指向另外一个指针类型的变量，这称为指向指针的指针。

```c
int i;
int *pi = &i;
int * * ppi = &pi;
```

这样定义之后，表达式＊ppi取pi的值，表达式＊＊ppi取i的值。

数组中的每个元素也可以是指针类型，这样的数组成为指针数组；

```c
int * a[10];
int * * pa = &a[0];
```

pa[0]和a[0]取的是同一个元素，唯一比原来复杂的地方在于元素的类型是int ＊指针，而不是基本类型。

### 函数类型和函数指针类型

在C语言中，函数也是一种类型，可以定义指向函数的指针。

我们知道，指针变量的内存单元里存放一个地址值，而函数指针的内存单元里存放的是函数的入口地址（位于.text段）。

## I/O

### 文件

文件可以分为文本文件（Text File）和二进制文件（Binary File）两种。源文件是文本文件，而目标文件、可执行文件和库文件是二进制文件。

### fopen/fclose

在操作文件之前要用fopen命令打开文件，操作完毕要用fclose命令关闭文件。打开文件就是在操作系统中分配一些资源用于保存该文件的状态信息，并得到该文件的标识，以后用户程序就可以用这个标识对文件做各种操作，关闭文件则释放文件在操作系统中占用的资源，使文件的标识失效，用户程序就无法再操作这个文件了。

FILE是C标准库中定义的结构体类型，其中包含该文件在内核中的标识、用户空间I/O缓冲区和当前读写位置等信息。

由rwab+五个字符组合了打开模式。r表示读；w表示写；a表示追加（Append），即在文件末尾追加数据使文件的尺寸增大；b表示二进制模式，不写b则表示文本模式。

rwa+四个字符有以下6种合法的组合：

"r"只读，文件必须已存在。

"w"只写，如果文件不存在则创建，如果文件已存在则把文件长度截断（Truncate）为0字节再重新写，也就是替换掉原来的文件内容。

"a"只能在文件末尾追加数据，如果文件不存在则创建。

"r+"允许读和写，文件必须已存在。

"w+"允许读和写，如果文件不存在则创建，如果文件已存在则把文件长度截断为0字节再重新写。

"a+"允许读和追加数据，如果文件不存在则创建。

### 以字节为单位的I/O

fgetc函数从指定的文件中读一个字节，getchar从标准输入读一个字节，调用getchar()相当于调用fgetc(stdin)。

fputc函数向指定的文件中写一个字节，putchar向标准输出写一个字节，调用putchar(c)相当于调用fputc(c, stdout)。

### 操作读写位置的函数

rewind函数可以把读写位置移到文件开头；

fseek可以任意改变读写位置；

ftell可以返回当前读写位置。

### 以字符串为单位的I/O函数

fgets从指定的文件中读一行字符到调用者提供的缓冲区中，gets从标准输入读一行字符到调用者提供的缓冲区中。

fputs向指定的文件中写入一个字符串，puts向标准输出写入一个字符串。

### 以记录为单位的I/O函数

fread和fwrite用于读写记录，这里的记录是指一串固定长度的字节，比如一个int、一个结构体或者一个定长数组。

### 格式化I/O函数

printf格式化打印到标准输出，而fprintf打印到指定的文件stream中。

