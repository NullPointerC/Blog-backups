---
title: Go语言学习-12-包
categories:
  - Go
tags:
  - Go
  - backend
abbrlink: 19ed7446
date: 2021-11-04 19:53:11
---

在工程化的Go语言开发项目中，Go语言的源码复用是建立在包（package）基础之上的。

## 包作用

`包（package）`是多个Go源码的集合，是一种高级的代码复用方案，Go语言为我们提供了很多内置包，如`fmt`、`os`、`io`等。

我们还可以根据自己的需要创建自己的包。一个包可以简单理解为一个存放`.go`文件的文件夹。 该文件夹下面的所有go文件都要在代码的第一行添加如下代码，声明该文件归属的包。

```go
package 包名
```

- 一个文件夹下面直接包含的文件只能归属一个`package`，同样一个`package`的文件不能在多个文件夹下。
- 包名可以不和文件夹的名字一样，包名不能包含 `-` 符号。
- 包名为`main`的包为应用程序的入口包，这种包编译后会得到一个可执行文件，而编译不包含`main`包的源代码则不会得到可执行文件。

## 可见性

如果想在一个包中引用另外一个包里的标识符（如变量、常量、类型、函数等）时，该标识符必须是对外可见的（public）。在Go语言中只需要将标识符的首字母大写就可以让标识符对外可见了。

结构体中的字段名和接口中的方法名如果首字母都是大写，外部包可以访问这些字段和方法。

## 导包

要在代码中引用其他包的内容，需要使用`import`关键字导入使用的包。

```go
import "包的路径"
```

注意事项：

- import导入语句通常放在文件开头包声明语句的下面。
- 导入的包名需要使用双引号包裹起来。
- 包名是从$GOPATH/src/后开始计算的，使用/进行路径分隔。
- Go语言中禁止循环导入包。

单行导入

```go
import "包1"
import "包2"
```

多行导入

```go
import (
    "包1"
    "包2"
)
```

## init()初始化函数

在Go语言程序执行时导入包语句会自动触发包内部`init()`函数的调用。需要注意的是： 

`init()`函数没有参数也没有返回值。 `init()`函数在程序运行时自动被调用执行，不能在代码中主动调用它。

![包中的init()执行时机](http://static.codenote.xyz/img/20211104200416.png)

Go语言包会从`main`包开始检查其导入的所有包，每个包中又可能导入了其他的包。Go编译器由此构建出一个树状的包引用关系，再根据引用顺序决定编译顺序，依次编译这些包的代码。

在运行时，被最后导入的包会最先初始化并调用其`init()`函数， 如下图示：

![包之间的init()执行顺序](http://static.codenote.xyz/img/20211104200507.png)

